<?php

/**
 * @file
 * Main WMS Tests
 * @ingroup wms 
 */
class WmsProcessWMSGetFeatureInfoResult extends DrupalWebTestCase {
  public static function getInfo() {
    return array(
      'name' => 'Check GML result parsing',
      'description' => 'Return an array based on a GetFeatureInfo XML Response',
      'group' => 'WMS',
    );
  }

  function setUp() {
    // Install modules
    parent::setUp('wms');
  }

  /**
   * 
   * This test tries to process the result of a simple getfeatureinfo call.
   * The xml is coming from the standard tasmania dataset, shipped with geoserver.
   */
  function testWMSGetFeatureRequest() {
    
    $xml = '<?xml version="1.0" encoding="UTF-8"?><wfs:featurecollection xmlns="http://www.opengis.net/wfs" xmlns:wfs="http://www.opengis.net/wfs" xmlns:topp="http://www.openplans.org/topp" xmlns:gml="http://www.opengis.net/gml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://www.openplans.org/topp http://localhost:8080/geoserver/wfs?service=WFS&amp;version=1.0.0&amp;request=DescribeFeatureType&amp;typeName=topp%3Atasmania_water_bodies http://www.opengis.net/wfs http://localhost:8080/geoserver/schemas/wfs/1.0.0/WFS-basic.xsd">
<gml:boundedby><gml:null>unknown</gml:null></gml:boundedby>
  <gml:featuremember>
      <topp:tasmania_water_bodies fid="tasmania_water_bodies.4">
        <topp:the_geom>
          <gml:multipolygon srsname="http://www.opengis.net/gml/srs/epsg.xml#4326">
             <gml:polygonmember>
               <gml:polygon>
                  <gml:outerboundaryis>
                     <gml:linearring>
                       <gml:coordinates style="" xmlns:gml="http://www.opengis.net/gml" decimal="." cs="," ts=" ">146.697205,-41.988892 146.688873,-41.988052 146.682465,-41.985832 146.67746,-41.976105 146.673859,-41.973328 146.674133,-41.966393 146.673309,-41.960281 146.674408,-41.95417 146.680817,-41.937218 146.696625,-41.907219 146.69693,-41.900551 146.694122,-41.895554 146.693573,-41.889442 146.695526,-41.883888 146.702179,-41.875275 146.703583,-41.869164 146.700256,-41.858055 146.697754,-41.853058 146.684418,-41.834999 146.680817,-41.83139 146.675812,-41.821671 146.674988,-41.815552 146.680267,-41.797783 146.683319,-41.792503 146.684418,-41.786949 146.691071,-41.778336 146.69693,-41.775558 146.704132,-41.776947 146.708588,-41.781387 146.714691,-41.789726 146.722748,-41.797226 146.728027,-41.800835 146.733582,-41.803055 146.75,-41.804718 146.761658,-41.816666 146.766663,-41.826393 146.772217,-41.828613 146.780548,-41.828613 146.808319,-41.821671 146.815796,-41.820557 146.823029,-41.822777 146.825531,-41.833061 146.824677,-41.853615 146.822754,-41.858894 146.816925,-41.868607 146.80304,-41.871666 146.786377,-41.872772 146.777191,-41.872498 146.764984,-41.876389 146.761108,-41.880554 146.759979,-41.886665 146.762207,-41.898338 146.767487,-41.908607 146.774414,-41.917221 146.779694,-41.927498 146.777771,-41.93222 146.765259,-41.943611 146.754425,-41.963333 146.749695,-41.96666 146.732727,-41.974716 146.728027,-41.97805 146.703857,-41.987778 146.697205,-41.988892</gml:coordinates>
                     </gml:linearring>
                   </gml:outerboundaryis>
                </gml:polygon>
             </gml:polygonmember>
           </gml:multipolygon>
        </topp:the_geom>
     <topp:area>1066494066</topp:area>
     <topp:perimeter>1071999090</topp:perimeter>
     <topp:water_type>Lake</topp:water_type>
     <topp:cntry_name>Australia</topp:cntry_name>
     <topp:continent>Australia</topp:continent>
     </topp:tasmania_water_bodies>
  </gml:featuremember>
</wfs:featurecollection>';
    
    $this->assertNotEqual(FALSE, wms_process_wmsgetfeatureinfo_result($xml)); // for now, just check if we did not fail, at least.
  }
}
